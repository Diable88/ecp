<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Trang chủ</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
	<div class="text-box">
		<p>SỐNG HẠNH PHÚC - SỐNG ECO CENTRAL PARK</p>
	</div>
	<div class="container">
		<img id="background" src="2.jpg" alt="Hình nền cố định"
			loading="lazy">
		<div class="upload-section">
			<div class="upload-buttons">
				<input type="file" id="imageUpload" hidden>
				<button id="changeBackground" hidden>CHỌN HÌNH NỀN MỚI</button>
				<input type="file" id="newBackgroundImage" hidden>
				<input type="file" id="newBackgroundImage">
				<label for="imageUpload" class="upload-button">CHỌN ẢNH</label>
				<button class="upload-submit" onclick="handleUpload()">UPLOAD</button>
			</div>
		</div>
	</div>

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
 <script>
    const API_NAME = "11111";
    const API_KEY = "ZhdsmrvYAwbSwwjMbNVh7Lzf";
    async function handleUpload() {
  const fileInput = document.getElementById('imageUpload');
  const uploadButton = document.querySelector('.upload-submit');
  const backgroundImage = document.getElementById("background");

  uploadButton.disabled = true;
  uploadButton.textContent = 'Đang xử lý...';

  const file = fileInput.files[0];
  
  // Đọc ảnh gốc và tạo một Image để lấy kích thước
  const reader = new FileReader();
  reader.onload = function(e) {
    const img = new Image();
    img.onload = function() {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');

      // Tính toán kích thước và tọa độ cắt để crop ảnh thành hình vuông
      let size = Math.min(img.width, img.height);
      let x = (img.width - size) / 2;
      let y = (img.height - size) / 2;

      // Crop ảnh thành hình vuông
      canvas.width = size;
      canvas.height = size;
      ctx.drawImage(img, x, y, size, size, 0, 0, size, size);

      // Chuyển canvas thành dạng blob và tạo FormData để gửi đi remove.bg
      canvas.toBlob(async function(blob) {
        const formData = new FormData();
        formData.append('size', 'auto');
        formData.append('image_file', blob);

        try {
          // Tiến hành gửi ảnh đã crop đi remove.bg
          const response = await fetch('https://api.remove.bg/v1.0/removebg', {
            method: 'POST',
            headers: {
              'X-Api-Key': API_KEY
            },
            body: formData
          });

          const processedImageURL = URL.createObjectURL(await response.blob());
          const processedImage = new Image();

          processedImage.onload = function() {
            var processedImageWidth = 140;
            var processedImageHeight = 210;
            var processedImageX = 630;
            var processedImageY = 104;

            const canvas = document.createElement('canvas');
            canvas.width = backgroundImage.naturalWidth;
            canvas.height = backgroundImage.naturalHeight;

            const ctx = canvas.getContext('2d');
            ctx.drawImage(backgroundImage, 0, 0);
            ctx.drawImage(processedImage, processedImageX, processedImageY, processedImageWidth, processedImageHeight);

            backgroundImage.src = canvas.toDataURL('image/jpeg');

            URL.revokeObjectURL(processedImageURL);

            uploadButton.disabled = false;
            uploadButton.textContent = 'UPLOAD';
          };

          processedImage.src = processedImageURL;

          uploadButton.disabled = false;
          uploadButton.textContent = 'UPLOAD';
        } catch (error) {
          console.error(error);

          uploadButton.disabled = false;
          uploadButton.textContent = 'UPLOAD';
        }
      }, 'image/jpeg');
    };

    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

// Các phần mã khác không thay đổi
  </script>
</body>

</html>
