<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Trang chủ</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <style>
    body {
      background-color: #529f46;
      margin: 0;
      padding: 0;
    }

    .background-layer {
      position: relative;
      width: 100%;
      height: 100vh;
      background-image: url('bgr.jpg');
      background-size: cover;
      background-position: center;
      z-index: 1;
    }

    .foreground-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('2.jpg');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: right center;
      z-index: 2;
    }

    .upload-section {
      position: relative;
      z-index: 3;
      text-align: center;
      margin-top: 50vh;
      transform: translateY(-50%);
    }

    .upload-buttons {
      margin-top: 16px;
    }

    .upload-button {
      margin-top: 8px;
      background-color: #529f46;
      color: white;
      font-weight: bold;
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .upload-submit {
      margin-top: 8px;
      background-color: #529f46;
      color: white;
      font-weight: bold;
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div class="background-layer"></div>
  <div class="foreground-layer"></div>
  <div class="upload-section">
    <div class="upload-buttons">
      <input type="file" id="imageUpload" hidden>
      <input type="file" id="newBackgroundImage" hidden>
      <button class="upload-button" onclick="handleBackgroundChange()">CHỌN HÌNH NỀN MỚI</button>
      <label for="imageUpload" class="upload-button">CHỌN ẢNH</label>
      <button class="upload-submit" onclick="handleUpload()">UPLOAD</button>
    </div>
  </div>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>
    const API_NAME = "Nova";
    const API_KEY = "hNk5sVoMrWRYGPserpvrsqwM";
    async function handleUpload()
    {
      const fileInput = document.getElementById('imageUpload');
      const uploadButton = document.querySelector('.upload-submit');
      const backgroundImage = document.getElementById("background");

      uploadButton.disabled = true;
      uploadButton.textContent = 'Đang xử lý...';

      const file = fileInput.files[0];
      const formData = new FormData();
      formData.append('size', 'auto');
      formData.append('image_file', file);

      try
      {
        const response = await fetch('https://api.remove.bg/v1.0/removebg', {
          method: 'POST',
          headers: {
            'X-Api-Key': API_KEY
          },
          body: formData
        });


        const processedImageURL = URL.createObjectURL(await response.blob());
        const processedImage = new Image();

        processedImage.onload = function ()
        {
          var processedImageWidth = 170;
          var processedImageHeight = 250;
          var processedImageX = 1140;
          var processedImageY = 175;

          const canvas = document.createElement('canvas');
          canvas.width = backgroundImage.naturalWidth;
          canvas.height = backgroundImage.naturalHeight;

          const ctx = canvas.getContext('2d');
          ctx.drawImage(backgroundImage, 0, 0);
          ctx.drawImage(processedImage, processedImageX, processedImageY, processedImageWidth, processedImageHeight);

          backgroundImage.src = canvas.toDataURL('image/jpeg');

          URL.revokeObjectURL(processedImageURL);

          uploadButton.disabled = false;
          uploadButton.textContent = 'UPLOAD';
        };

        processedImage.src = processedImageURL;

        uploadButton.disabled = false;
        uploadButton.textContent = 'UPLOAD';
      } catch (error)
      {
        console.error(error);

        uploadButton.disabled = false;
        uploadButton.textContent = 'UPLOAD';
      }
    }

    const button = document.getElementById('changeBackground');
    const fileInput = document.getElementById('newBackgroundImage');

    button.addEventListener('click', function ()
    {
      fileInput.click();
    });

    fileInput.addEventListener('change', function ()
    {
      const file = this.files[0];
      const reader = new FileReader();

      reader.onload = function (e)
      {
        const backgroundImage = document.getElementById("background");
        backgroundImage.src = e.target.result;
      }

      reader.readAsDataURL(file);
    });
     </script>
</body>
</html>
