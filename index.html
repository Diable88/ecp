<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Trang chủ</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <style>
    /* Đã bỏ CSS vào file style.css */
  </style>
</head>

<body>
  <div class="container">
    <div class="bar"></div>
    <div class="image-container">
      <img src="2.jpg" alt="Ảnh">
    </div>
    <div class="text">
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non diam id erat convallis efficitur. Maecenas ullamcorper
      sapien in dictum sodales. Morbi at sagittis velit. Vestibulum volutpat urna in ipsum rhoncus rhoncus. Integer vitae velit
      justo. Proin varius bibendum vehicula. Donec pharetra dapibus lobortis.
    </div>
    <div class="select-image">
      <input type="file" id="imageUpload" hidden>
      <label for="imageUpload">CHỌN ẢNH</label>
    </div>
    <button class="upload-button" onclick="handleUpload()">BẮT ĐẦU</button>
  </div>

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>
    const API_NAME = 'Nova';
    const API_KEY = 'hNk5sVoMrWRYGPserpvrsqwM';

    async function handleUpload() {
      const fileInput = document.getElementById('imageUpload');
      const uploadButton = document.querySelector('.upload-button');
      const imageContainer = document.querySelector('.image-container');

      uploadButton.disabled = true;
      uploadButton.textContent = 'Đang xử lý...';

      const file = fileInput.files[0];
      const formData = new FormData();
      formData.append('size', 'auto');
      formData.append('image_file', file);

      try {
        const response = await fetch('https://api.remove.bg/v1.0/removebg', {
          method: 'POST',
          headers: {
            'X-Api-Key': API_KEY,
          },
          body: formData,
        });

        const processedImageURL = URL.createObjectURL(await response.blob());
        const processedImage = new Image();
        
        processedImage.onload = function () {
          var processedImageWidth = 170;
          var processedImageHeight = 250;
          var processedImageX = 1140;
          var processedImageY = 175;

          const canvas = document.createElement('canvas');
          canvas.width = imageContainer.naturalWidth;
          canvas.height = imageContainer.naturalHeight;

          const ctx = canvas.getContext('2d');
          ctx.drawImage(imageContainer.querySelector('img'), 0, 0);
          ctx.drawImage(
            processedImage,
            processedImageX,
            processedImageY,
            processedImageWidth,
            processedImageHeight
          );

          const dataURL = canvas.toDataURL('image/jpeg');
          imageContainer.innerHTML = `<img src="${dataURL}" alt="Ảnh">`;

          URL.revokeObjectURL(processedImageURL);

          uploadButton.disabled = false;
          uploadButton.textContent = 'UPLOAD';
        };

        processedImage.src = processedImageURL;
      } catch (error) {
        console.error(error);

        uploadButton.disabled = false;
        uploadButton.textContent = 'UPLOAD';
      }
    }

    const button = document.getElementById('newBackgroundButton');
    const fileInput = document.getElementById('imageUpload');
    
    button.addEventListener('click', function () {
      fileInput.click();
    });
    
    fileInput.addEventListener('change', function () {
      const file = this.files[0];
      const reader = new FileReader();
    
      reader.onload = function (e) {
        const backgroundImage = document.querySelector('.image-container img');
        backgroundImage.src = e.target.result;
      };
    
      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
